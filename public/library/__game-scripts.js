pc.extend(pc,function(){var FxaaEffect=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return(FxaaEffect=pc.inherits(FxaaEffect,pc.PostEffect)).prototype=pc.extend(FxaaEffect.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:FxaaEffect}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};pc.extend(pc,function(){var BrightnessContrastEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return(BrightnessContrastEffect=pc.inherits(BrightnessContrastEffect,pc.PostEffect)).prototype=pc.extend(BrightnessContrastEffect.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:BrightnessContrastEffect}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var FlyCamera=pc.createScript("flyCamera");FlyCamera.attributes.add("speed",{type:"number",default:10}),FlyCamera.attributes.add("fastSpeed",{type:"number",default:20}),FlyCamera.attributes.add("mode",{type:"number",default:0,enum:[{Lock:0},{Drag:1}]}),FlyCamera.prototype.initialize=function(){var e=this.entity.getLocalEulerAngles();this.ex=e.x,this.ey=e.y,this.moved=!1,this.lmbDown=!1,this.app.mouse.disableContextMenu(),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)},FlyCamera.prototype.update=function(e){this.entity.setLocalEulerAngles(this.ex,this.ey,0);var t=this.app,s=this.speed;t.keyboard.isPressed(pc.KEY_SHIFT)&&(s=this.fastSpeed),t.keyboard.isPressed(pc.KEY_UP)||t.keyboard.isPressed(pc.KEY_W)?this.entity.translateLocal(0,0,-s*e):(t.keyboard.isPressed(pc.KEY_DOWN)||t.keyboard.isPressed(pc.KEY_S))&&this.entity.translateLocal(0,0,s*e),t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_A)?this.entity.translateLocal(-s*e,0,0):(t.keyboard.isPressed(pc.KEY_RIGHT)||t.keyboard.isPressed(pc.KEY_D))&&this.entity.translateLocal(s*e,0,0)},FlyCamera.prototype.onMouseMove=function(e){if(this.mode){if(!this.lmbDown)return}else if(!pc.Mouse.isPointerLocked())return;this.moved?(this.ex-=e.dy/5,this.ex=pc.math.clamp(this.ex,-90,90),this.ey-=e.dx/5):this.moved=!0},FlyCamera.prototype.onMouseDown=function(e){0===e.button&&(this.lmbDown=!0,this.mode||pc.Mouse.isPointerLocked()||this.app.mouse.enablePointerLock())},FlyCamera.prototype.onMouseUp=function(e){0===e.button&&(this.lmbDown=!1)};var Camera360=pc.createScript("camera360");Camera360.attributes.add("mouseLookSensitivity",{type:"number",default:0,title:"Mouse Look Sensitivity",description:""}),Camera360.attributes.add("touchLookSensitivity",{type:"number",default:0,title:"Touch Look Sensitivity",description:""}),Camera360.attributes.add("sphere",{type:"entity",title:"Sphere"}),Camera360.prototype.initialize=function(){var t=this,e=this.entity.getLocalRotation();this.ex=this.getPitch(e)*pc.math.RAD_TO_DEG,this.ey=this.getYaw(e)*pc.math.RAD_TO_DEG,this.ez=this.getRoll(e)*pc.math.RAD_TO_DEG,this._offsetParent=this.entity.parent,this._hasStageParams=!1,this.targetEx=this.ex,this.targetEy=this.ey,this.targetEz=this.ez,this.moved=!1,this.lmbDown=!1,this.app.mouse.disableContextMenu(),this.lastTouchPosition=new pc.Vec2,this.addEventCallbacks(),this.on("destroy",(function(){this.removeEventCallbacks()})),this.app.xr.on("start",(function(){this.entity.setLocalEulerAngles(0,0,0)}),this),this.canLook=!0,this.app.on("lockCamera",(function(){t.canLook=!1})),this.app.on("unlockCamera",(function(){var e=t.entity.getLocalEulerAngles();t.ex=e.x,t.ey=e.y,t.ez=e.z,t.targetEx=e.x,t.targetEy=e.y,t.targetEz=e.z,t.canLook=!0}))},Camera360.prototype.deact=function(){var t=this;setTimeout((function(){var e=t.entity.getLocalRotation();t.ex=t.getPitch(e)*pc.math.RAD_TO_DEG,t.ey=t.getYaw(e)*pc.math.RAD_TO_DEG,t.ez=t.getRoll(e)*pc.math.RAD_TO_DEG,t.targetEx=t.ex,t.targetEy=t.ey,t.targetEz=t.ez,t.canLook=!0}),3e3)},Camera360.prototype.teleport=function(t){var e=pc.DEFAULT_HUMAN_HEIGHT;this._hasStageParams&&(e=0);var o=(new pc.Vec3).sub2(this.entity.getPosition(),this._offsetParent.getPosition()).scale(-1),i=new pc.Vec3(t.x+o.x,t.y+e,t.z+o.z);this._offsetParent.script.cameraLerp.updatePosInstant(i)},Camera360.prototype.addEventCallbacks=function(){this.app.mouse&&(this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this)),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this))},Camera360.prototype.removeEventCallbacks=function(){this.app.mouse&&(this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.mouse.off(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onMouseUp,this)),this.app.touch&&(this.app.touch.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchCancel,this))},Camera360.prototype.getYaw=function(t){var e=t,o=e.x*e.x,i=e.y*e.y;return Math.atan2(2*e.y*e.w-2*e.z*e.x,1-2*i-2*o)},Camera360.prototype.getPitch=function(t){var e=t;return-Math.asin(2*e.z*e.y+2*e.x*e.w)},Camera360.prototype.getRoll=function(t){var e=t,o=e.x*e.x,i=e.z*e.z;return Math.atan2(2*e.z*e.w-2*e.y*e.x,1-2*i-2*o)},Camera360.prototype.update=function(t){this.canLook&&(this.ex=pc.math.lerp(this.ex,this.targetEx,t/.2),this.ey=pc.math.lerp(this.ey,this.targetEy,t/.2),this.ez=pc.math.lerp(this.ez,this.targetEz,t/.2),this.app.xr.active||this.entity.setLocalEulerAngles(this.ex,this.ey,this.ez),this.sphere.setPosition(this.entity.getPosition()))},Camera360.prototype.moveCamera=function(t,e,o){this.canLook&&(this.moved?(this.targetEx+=e*o,this.targetEz<-90?this.targetEz=-180:this.targetEz>90?this.targetEz=180:this.targetEz=0,0===this.targetEz?this.targetEy+=t*o:this.targetEy-=t*o):this.moved=!0)},Camera360.prototype.onMouseMove=function(t){this.lmbDown&&(void 0!==window.parent.disablePosterGradient&&window.parent.disablePosterGradient(),this.moveCamera(t.dx,t.dy,this.mouseLookSensitivity))},Camera360.prototype.onMouseDown=function(t){0===t.button&&(this.lmbDown=!0)},Camera360.prototype.onMouseUp=function(t){0===t.button&&(this.lmbDown=!1)},Camera360.prototype.onTouchStart=function(t){if(1==t.touches.length){this.lmbDown=!0;var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)}t.event.preventDefault()},Camera360.prototype.onTouchEnd=function(t){if(0===t.touches.length)this.lmbDown=!1;else if(1==t.touches.length){var e=t.touches[0];this.lastTouchPosition.set(e.x,e.y)}},Camera360.prototype.onTouchMove=function(t){var e=t.touches[0];1==t.touches.length&&(this.moveCamera(e.x-this.lastTouchPosition.x,e.y-this.lastTouchPosition.y,this.touchLookSensitivity),void 0!==window.parent.disablePosterGradient&&window.parent.disablePosterGradient()),this.lastTouchPosition.set(e.x,e.y)},Camera360.prototype.onTouchCancel=function(t){this.lmbDown=!1};var RenderLayer=pc.createScript("renderLayer");RenderLayer.attributes.add("layer",{type:"number",default:14,title:"Layer",description:"Has to be between a value of 3 and 14. 3 being the highest priority"}),RenderLayer.prototype.initialize=function(){this.on("attr:layer",(function(e,t){this._setLayer(e)})),this._setLayer(this.layer)},RenderLayer.prototype._setLayer=function(e){e=pc.math.clamp(e,0,15);var t=null,a=0;if(this.entity.model&&(t=this.entity.model.meshInstances))for(a=0;a<t.length;++a)t[a].layer=e;var r=this.entity.particlesystem;r&&r.emitter.meshInstance&&(r.emitter.meshInstance.layer=e);var n=this.entity.element;if(n&&(n._text&&n._text._meshInstance&&(n._text._meshInstance.layer=e),n._image&&(t=n._image._model.meshInstances)))for(a=0;a<t.length;++a)t[a].layer=e};var PointAndClick=pc.createScript("pointAndClick");PointAndClick.attributes.add("cameraNearClip",{type:"entity",title:"Camera NearClip"}),PointAndClick.attributes.add("cameraFarClip",{type:"entity",title:"Camera FarClip"}),PointAndClick.attributes.add("cameraEntity",{type:"entity",title:"Camera Entity"}),PointAndClick.attributes.add("playerEntity",{type:"entity",title:"Player Entity"}),PointAndClick.attributes.add("playerDummy",{type:"entity",title:"Player Dummy"}),PointAndClick.attributes.add("moveInvalidEntity",{type:"entity",title:"Move Entity"}),PointAndClick.attributes.add("moveToEntity",{type:"entity",title:"Move Entity"}),PointAndClick.attributes.add("dir",{type:"entity",title:"Dir Entity"}),PointAndClick.attributes.add("playerSpeed",{type:"number",default:1,title:"Player Speed"}),PointAndClick.attributes.add("doFullScreen",{type:"boolean"}),PointAndClick.prototype.initialize=function(){var t=this;this.doFullScreen&&this.app.enableFullscreen(null,(function(){}),(function(){})),this.originalY=this.playerEntity.getPosition().y,this.groundShape=new pc.BoundingBox(new pc.Vec3(0,0,0),new pc.Vec3(10,.001,10)),this.downPos=new pc.Vec2,this.direction=new pc.Vec3,this.distanceToTravel=0,this.targetPosition=new pc.Vec3,this.targetPosition=this.playerEntity.getPosition(),this.app.mouse.on(pc.EVENT_MOUSEDOWN,this.onMouseDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onMouseUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMouseMove,this),this.app.touch&&(this.app.touch.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this)),this.highlightedObj=this.cameraEntity,this.canUpdate=!0,this.app.on("lockCamera",(function(){t.canUpdate=!1,t.moveToEntity.enabled=!1})),this.app.on("unlockCamera",(function(){t.canUpdate=!0,t.moveToEntity.enabled=!0,t.resetTargetPos()})),this.app.on("stopRaycast",(function(){t.canUpdate=!1,t.moveToEntity.enabled=!1})),this.app.on("resumeRaycast",(function(){t.canUpdate=!0,t.moveToEntity.enabled=!0,t.resetTargetPos()})),this.isMouseDown=!1,this.moving=!1},PointAndClick.prototype.getStalled=function(){return PointAndClick.hasStalled},PointAndClick.prototype.getDragged=function(){return PointAndClick.hasDragged},PointAndClick.prototype.getMoved=function(){return PointAndClick.hasMoved},PointAndClick.hasStalled=!1,PointAndClick.hasDragged=!1,PointAndClick.hasMoved=!1,PointAndClick.otherObjChat=null,PointAndClick.newPosition=new pc.Vec3,this.movementDuration=3,this.time=0,PointAndClick.prototype.postUpdate=function(t){if(this.canUpdate){var i=this.playerEntity.getPosition();i.y=0;var o=this.targetPosition;o.y=0,this.direction.sub2(o,i),this.distanceToTravel=this.direction.length()}},PointAndClick.prototype.movePlayerTo=function(t){this.targetPosition.copy(t)},PointAndClick.prototype.onMouseDown=function(t){t.button==pc.MOUSEBUTTON_LEFT&&(this.isMouseDown=!0,this.downPos=new pc.Vec2(t.x,t.y)),this.canUpdate&&(document.body.style.cursor="grabbing")},PointAndClick.prototype.onMouseUp=function(t){if(t.button==pc.MOUSEBUTTON_LEFT){var i=new pc.Vec2;this.isMouseDown=!1,i.sub2(this.downPos,new pc.Vec2(t.x,t.y)),i.length()<1&&this.doRayCast(t)}this.canUpdate&&(document.body.style.cursor="grab")},PointAndClick.prototype.onMouseMove=function(t){this.distanceToTravel<=.6?this.moving=!1:this.moving=!0,this.doRayCastForMouse(t)},PointAndClick.touchmoved=!1,PointAndClick.prototype.onTouchStart=function(t){1==t.touches.length&&(PointAndClick.touchmoved=!1,this.downPos=new pc.Vec2(t.touches[0].x,t.touches[0].y),t.event.preventDefault())},PointAndClick.prototype.onTouchMove=function(t){var i=new pc.Vec2;i.sub2(this.downPos,new pc.Vec2(t.touches[0].x,t.touches[0].y)),i.length()>.5&&(PointAndClick.touchmoved=!0),PointAndClick.hasDragged=!0,this.distanceToTravel<=.6&&this.doRayCastForMouse(t.touches[0]),t.event.preventDefault()},PointAndClick.prototype.onTouchEnd=function(t){PointAndClick.touchmoved?PointAndClick.touchmoved=!1:this.doRayCast(this.downPos),t.event.preventDefault()},PointAndClick.prototype.resetTargetPos=function(){this.targetPosition=this.playerEntity.getPosition()},PointAndClick.ray=new pc.Ray,PointAndClick.lookAtIt=!1,PointAndClick.lookAtPos=new pc.Vec3,PointAndClick.hitPosition=new pc.Vec3,PointAndClick.prototype.doRayCast=function(t){if(this.canUpdate){var i=this.cameraEntity.getPosition(),o=PointAndClick.hitPosition,n=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraFarClip.camera.farClip),e=this.app.systems.rigidbody.raycastFirst(i,n);if(e){var s=e.entity;if(s.tags.has("stall"))s.fire("object:onhover"),s.fire("object:interact"),PointAndClick.hasStalled=!0,PointAndClick.hasMoved=!0,PointAndClick.hasDragged=!0,null!==PointAndClick.otherObjChat&&(PointAndClick.otherObjChat.script.otherHandler.end(),PointAndClick.otherObjChat=null),setTimeout((function(){s.fire("object:offhover")}),1e3);else if(s.tags.has("other"))PointAndClick.lookAtPos=e.entity.getPosition(),PointAndClick.hasMoved=!0,PointAndClick.lookAtIt=!0,null!==PointAndClick.otherObjChat&&(PointAndClick.otherObjChat.script.otherHandler.end(),PointAndClick.otherObjChat=null),e.entity.script.otherHandler.initiate(),PointAndClick.otherObjChat=s;else if("Ground"==s.name){PointAndClick.lookAtIt=!1,o=e.point,this.moveToEntity.setPosition(o),this.targetPosition=o;var a=o;a.y=this.originalY,PointAndClick.hasMoved=!0,this.playerEntity.script.cameraLerp.updatePos(a),null!==PointAndClick.otherObjChat&&(PointAndClick.otherObjChat.script.otherHandler.end(),PointAndClick.otherObjChat=null),this.app.fire("endInteraction"),this.entity.script.network&&this.entity.script.network.updatePosition(o),this.moveToEntity.children[0].setLocalScale(1,1,1),this.moveToEntity.children[0].enabled=!0}else this.dir.setPosition(o)}}},PointAndClick.prototype.doRayCastForMouse=function(t){if(this.canUpdate){var i=this.cameraEntity.getPosition(),o=PointAndClick.hitPosition,n=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraFarClip.camera.farClip),e=this.app.systems.rigidbody.raycastFirst(i,n);if(e){var s=e.entity;this.isMouseDown&&(PointAndClick.hasDragged=!0),o=e.point,s.tags.has("stall")||s.tags.has("other")?this.isMouseDown||this.highlightedObj!=s&&(this.highlightedObj.fire("object:offhover"),s.fire("object:onhover"),this.highlightedObj=s,this.moveToEntity.enabled=!1,document.body.style.cursor="pointer"):"Ground"==s.name?this.moving||(this.isMouseDown?this.moveToEntity.enabled=!1:(this.highlightedObj.fire("object:offhover"),this.highlightedObj=s,this.moveToEntity.setPosition(o),this.moveToEntity.enabled=!0,document.body.style.cursor="pointer")):this.isMouseDown||(this.highlightedObj.fire("object:offhover"),this.highlightedObj=s,this.dir.setPosition(o),this.moveToEntity.enabled=!1,document.body.style.cursor="grab"),this.moveInvalidEntity.enabled=!1}else this.isMouseDown?(this.moveToEntity.enabled=!1,this.moveInvalidEntity.enabled=!1):(this.doRayCastForInvalid(event),this.moveToEntity.enabled=!1,document.body.style.cursor="grab")}},PointAndClick.prototype.doRayCastForInvalid=function(t){if(this.canUpdate){var i=this.cameraEntity.getPosition(),o=PointAndClick.hitPosition,n=this.cameraEntity.camera.screenToWorld(t.x,t.y,this.cameraNearClip.camera.farClip),e=this.app.systems.rigidbody.raycastFirst(i,n);if(e){var s=e.entity;o=e.point,s.tags.has("stall")||"Ground"==s.name&&(this.moveInvalidEntity.setPosition(o),this.moveInvalidEntity.enabled=!0)}}};var FirstPersonMovement=pc.createScript("firstPersonMovement");FirstPersonMovement.attributes.add("camera",{type:"entity",description:"Optional, assign a camera entity, otherwise one is created"}),FirstPersonMovement.attributes.add("power",{type:"number",default:2500,description:"Adjusts the speed of player movement"}),FirstPersonMovement.attributes.add("lookSpeed",{type:"number",default:.25,description:"Adjusts the sensitivity of looking"}),FirstPersonMovement.prototype.initialize=function(){this.force=new pc.Vec3,this.eulers=new pc.Vec3;this.app;var e=this;this.entity.collision||console.error("First Person Movement script needs to have a 'collision' component"),this.entity.rigidbody&&this.entity.rigidbody.type===pc.BODYTYPE_DYNAMIC||console.error("First Person Movement script needs to have a DYNAMIC 'rigidbody' component"),this.canUpdate=!0,this.app.on("lockMovement",(function(){e.canUpdate=!1})),this.app.fire("unlockMovement"),this.app.on("unlockMovement",(function(){e.canUpdate=!0}))},FirstPersonMovement.prototype.update=function(e){var t=this.app;if(this.canUpdate){this.camera||this._createCamera();var r=this.force,i=this.camera.forward,s=this.camera.right,o=0,n=0;(t.keyboard.isPressed(pc.KEY_A)||t.keyboard.isPressed(pc.KEY_LEFT)||t.keyboard.isPressed(pc.KEY_Q))&&(this.entity.script.get("cameraLerp").resetPercent(),o-=s.x,n-=s.z,t.fire("endInteraction")),(t.keyboard.isPressed(pc.KEY_D)||t.keyboard.isPressed(pc.KEY_RIGHT))&&(this.entity.script.get("cameraLerp").resetPercent(),o+=s.x,n+=s.z,t.fire("endInteraction")),(t.keyboard.isPressed(pc.KEY_W)||t.keyboard.isPressed(pc.KEY_UP))&&(this.entity.script.get("cameraLerp").resetPercent(),o+=i.x,n+=i.z,t.fire("endInteraction")),(t.keyboard.isPressed(pc.KEY_S)||t.keyboard.isPressed(pc.KEY_DOWN))&&(this.entity.script.get("cameraLerp").resetPercent(),o-=i.x,n-=i.z,t.fire("endInteraction")),0!==o&&0!==n&&(this.entity.rigidbody.type=pc.BODYTYPE_DYNAMIC,r.set(o,0,n).normalize().scale(this.power),this.entity.rigidbody.applyForce(r))}},FirstPersonMovement.prototype._onMouseMove=function(e){(pc.Mouse.isPointerLocked()||e.buttons[0])&&(this.eulers.x-=this.lookSpeed*e.dx,this.eulers.y-=this.lookSpeed*e.dy)},FirstPersonMovement.prototype._createCamera=function(){this.camera=new pc.Entity,this.camera.setName("First Person Camera"),this.camera.addComponent("camera"),this.entity.addChild(this.camera),this.camera.translateLocal(0,.5,0)};var cameraLerpInstance,CameraLerp=pc.createScript("cameraLerp");CameraLerp.attributes.add("duration",{type:"number",default:5,title:"Duration (Secs)"}),CameraLerp.prototype.initialize=function(){cameraLerpInstance=this,this.time=0,this.pointA=new pc.Vec3,this.pointB=new pc.Vec3,this.lookHere=new pc.Vec3,this.rotateB=new pc.Quat,this.move=!1,this.percent=1,this.canRotate=!1,this.dur=this.duration},CameraLerp.prototype.updatePos=function(t){this.pointA=this.entity.getPosition(),this.pointB=t,this.time=0,this.move=!0,this.duration=this.dur},CameraLerp.prototype.updatePointB=function(t,e){this.pointA=this.entity.getPosition(),this.pointB=t,this.duration=e,this.time=0,this.move=!0},CameraLerp.prototype.endRot=function(t){this.canRotate=!1},CameraLerp.prototype.updateLookAt=function(t){this.lookHere=t,this.time=0,this.canRotate=!0,this.move=!0},CameraLerp.prototype.updateRot=function(t){this.rotateB=t,this.time=0,this.canRotate=!0,this.move=!0},CameraLerp.prototype.updatePosInstant=function(t){this.pointA=t,this.pointB=t,this.time=0,this.move=!0},CameraLerp.prototype.resetPercent=function(){this.move=!1,this.percent=1,this.entity.rigidbody.type=pc.BODYTYPE_DYNAMIC},CameraLerp.prototype.update=function(t){if(this.move){if(this.time+=t,this.percent=this.time/this.duration,this.percent<1){this.entity.rigidbody.type=pc.BODYTYPE_KINEMATIC;var e=this.entity.getPosition();this.pointB.y=this.entity.getPosition().y,e.lerp(this.pointA,this.pointB,this.percent),this.entity.setPosition(e)}if(this.canRotate&&this.percent<1){var i=this.entity.children[0].getRotation(),o=this.rotateTowards(i,this.rotateB,this.percent);this.entity.children[0].setRotation(o)}}},CameraLerp.prototype.rotateTowards=function(t,e,i){return 0===this.quatAngle(t,e)?e:(new pc.Quat).slerp(t,e,i)},CameraLerp.prototype.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},CameraLerp.prototype.quatAngle=function(t,e){var i=this.dot(t,e);if(t.equals(e))return 0;var o=1/(Math.PI/180);return 2*Math.acos(Math.min(Math.abs(i),1))*o};var AnimateRing=pc.createScript("animateRing");AnimateRing.attributes.add("speed",{type:"number"}),AnimateRing.attributes.add("loop",{type:"boolean",default:!1}),AnimateRing.prototype.initialize=function(){},AnimateRing.prototype.update=function(t){var e=this.entity.getLocalScale().x,i=e+e*t*this.speed,a=1.6-i;a<0?(a=0,this.loop?(this.entity.setLocalScale(1,1,1),this.entity.model.material.opacity=0):this.entity.enabled=!1):(this.entity.setLocalScale(i,i,i),this.entity.model.material.opacity=a*(this.speed+.2),this.entity.model.material.update())};var LookCamera=pc.createScript("lookCamera");Object.defineProperty(LookCamera.prototype,"pitch",{get:function(){return this._pitch},set:function(t){this._pitch=pc.math.clamp(t,-90,90)}}),Object.defineProperty(LookCamera.prototype,"yaw",{get:function(){return this._yaw},set:function(t){this._yaw=t}});var canLook=!0;LookCamera.prototype.teleport=function(t){var a=pc.DEFAULT_HUMAN_HEIGHT;this._hasStageParams&&(a=0);var e=(new pc.Vec3).sub2(this.entity.getPosition(),this._offsetParent.getPosition()).scale(-1);this._offsetParent.setPosition(t.x+e.x,t.y+a,t.z+e.z)},LookCamera.prototype.getRotationDiff=function(){return this._rotationDiff},LookCamera.prototype.initialize=function(){this._offsetParent=this.entity.parent;var t=this.entity.getRotation();pc.util&&(this._yaw=pc.util.getYaw(t)),this._pitch=this._getPitch(t,this._yaw),this._prevYaw=this._yaw,this._magicWindowEnabled=!1,this._presenting=!1,this._hasStageParams=!1,this._prevRotation=new pc.Vec2(this._pitch,this._yaw),this._rotationDiff=new pc.Vec2(0,0),this._blackoutModel=this.entity.findByName("Blackout Plane"),this._blackoutAlpha=0,canLook=!0,this.app.on("lockCamera",(function(){canLook=!1})),this.app.on("unlockCamera",(function(){canLook=!0}))},LookCamera.debugCameraOffset=new pc.Vec3,LookCamera.BLACKOUT_LERP_FACTOR=12,LookCamera.prototype.update=function(t){if(canLook){this._magicWindowEnabled||this._presenting?this._offsetParent.setLocalEulerAngles(0,this.yaw,0):this._offsetParent.setLocalEulerAngles(this.pitch,this.yaw,0),this._presenting&&(this._prevYaw!=this.yaw?this._blackoutAlpha=pc.math.lerp(this._blackoutAlpha,1,Math.min(LookCamera.BLACKOUT_LERP_FACTOR*t)):this._blackoutAlpha=pc.math.lerp(this._blackoutAlpha,0,Math.min(LookCamera.BLACKOUT_LERP_FACTOR*t/3))),this._blackoutAlpha>.001?this._blackoutModel.enabled||(this._blackoutModel.enabled=!0):this._blackoutModel.enabled&&(this._blackoutModel.enabled=!1),pc.util.setEntityAlpha(this._blackoutModel,this._blackoutAlpha);var a=this.entity.getRotation(),e=pc.util.getYaw(a),i=this._getPitch(a,e);this._rotationDiff.set(i-this._prevRotation.x,e-this._prevRotation.y),this._prevRotation.set(i,e),this._prevYaw=this.yaw}},LookCamera.prototype._onVrPresentChange=function(t){if(t.presenting)this._offsetParent.setLocalEulerAngles(0,this.yaw,0),this._presenting=!0;else{if(this._magicWindowEnabled&&this.app.vr&&this.app.vr.display){var a=this.app.vr.display;this.entity.camera.vrDisplay=a}this._blackoutAlpha=0,this._presenting=!1}},LookCamera.quatWithoutYaw=new pc.Quat,LookCamera.yawOffset=new pc.Quat,LookCamera.prototype._getPitch=function(t,a){var e=LookCamera.quatWithoutYaw,i=LookCamera.yawOffset;i.setFromEulerAngles(0,-a,0),e.mul2(i,t);var o=new pc.Vec3;return e.transformVector(pc.Vec3.FORWARD,o),Math.atan2(o.y,-o.z)*pc.math.RAD_TO_DEG};var nextSceneInstance,NextScene=pc.createScript("nextScene");NextScene.attributes.add("url",{type:"string",title:"Site Link"}),NextScene.prototype.initialize=function(){var t=this,e=this.app;this.entity.button.on("click",(function(){window.localStorage.setItem("lobbySpawning","library"),void 0!==window.parent.switchScene&&window.parent.switchScene(t.url)})),this.entity.button.on("hoverstart",(function(){document.body.style.cursor="pointer",e.fire("stopRaycast")})),this.entity.button.on("hoverend",(function(){document.body.style.cursor="context-menu",e.fire("resumeRaycast")}))};var LookAtcamera=pc.createScript("lookAtcamera");LookAtcamera.attributes.add("camera",{type:"entity"}),LookAtcamera.prototype.initialize=function(){},LookAtcamera.prototype.update=function(t){this.entity.lookAt(this.camera.getPosition());var e=this.entity.getEulerAngles().x,a=(this.entity.getEulerAngles().y,this.entity.getEulerAngles().z);this.entity.setEulerAngles(e,this.entity.getEulerAngles().y+180,a)},LookAtcamera.prototype.rotateTowards=function(t,e,a){var i=this.quatAngle(t,e);return 0===i?e:(new pc.Quat).slerp(t,e,Math.min(1,a/i))};pc.extend(pc,function(){var SepiaEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","","uniform float uAmount;","uniform sampler2D uColorBuffer;","","varying vec2 vUv0;","","void main() {","    vec4 color = texture2D(uColorBuffer, vUv0);","    vec3 c = color.rgb;","","    color.r = dot(c, vec3(1.0 - 0.607 * uAmount, 0.769 * uAmount, 0.189 * uAmount));","    color.g = dot(c, vec3(0.349 * uAmount, 1.0 - 0.314 * uAmount, 0.168 * uAmount));","    color.b = dot(c, vec3(0.272 * uAmount, 0.534 * uAmount, 1.0 - 0.869 * uAmount));","","    gl_FragColor = vec4(min(vec3(1.0), color.rgb), color.a);","}"].join("\n")}),this.amount=1};return(SepiaEffect=pc.inherits(SepiaEffect,pc.PostEffect)).prototype=pc.extend(SepiaEffect.prototype,{render:function(t,e,o){var i=this.device,n=i.scope;n.resolve("uAmount").setValue(this.amount),n.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(i,e,this.vertexBuffer,this.shader,o)}}),{SepiaEffect:SepiaEffect}}());var Sepia=pc.createScript("sepia");Sepia.attributes.add("amount",{type:"number",default:1,min:0,max:1,title:"Amount"}),Sepia.prototype.initialize=function(){this.effect=new pc.SepiaEffect(this.app.graphicsDevice),this.effect.amount=this.amount,this.on("attr:amount",(function(t){this.effect.amount=t}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};pc.extend(pc,function(){function computeGaussian(e,t){return 1/Math.sqrt(2*Math.PI*t)*Math.exp(-e*e/(2*t*t))}function calculateBlurValues(e,t,s,o,r){e[0]=computeGaussian(0,r),t[0]=0,t[1]=0;var i,a,l=e[0];for(i=0,a=Math.floor(7.5);i<a;i++){var u=computeGaussian(i+1,r);e[2*i]=u,e[2*i+1]=u,l+=2*u;var h=2*i+1.5;t[4*i]=s*h,t[4*i+1]=o*h,t[4*i+2]=-s*h,t[4*i+3]=-o*h}for(i=0,a=e.length;i<a;i++)e[i]/=l}var BloomEffect=function(e){var t={aPosition:pc.SEMANTIC_POSITION},s=["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition + 1.0) * 0.5;","}"].join("\n"),o=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform sampler2D uBaseTexture;","uniform float uBloomThreshold;","","void main(void)","{","    vec4 color = texture2D(uBaseTexture, vUv0);","","    gl_FragColor = clamp((color - uBloomThreshold) / (1.0 - uBloomThreshold), 0.0, 1.0);","}"].join("\n"),r=["precision "+e.precision+" float;","","#define SAMPLE_COUNT 15","","varying vec2 vUv0;","","uniform sampler2D uBloomTexture;","uniform vec2 uBlurOffsets[SAMPLE_COUNT];","uniform float uBlurWeights[SAMPLE_COUNT];","","void main(void)","{","    vec4 color = vec4(0.0);","    for (int i = 0; i < SAMPLE_COUNT; i++)","    {","        color += texture2D(uBloomTexture, vUv0 + uBlurOffsets[i]) * uBlurWeights[i];","    }","","    gl_FragColor = color;","}"].join("\n"),i=["precision "+e.precision+" float;","","varying vec2 vUv0;","","uniform float uBloomEffectIntensity;","uniform sampler2D uBaseTexture;","uniform sampler2D uBloomTexture;","","void main(void)","{","    vec4 bloom = texture2D(uBloomTexture, vUv0) * uBloomEffectIntensity;","    vec4 base = texture2D(uBaseTexture, vUv0);","","    base *= (1.0 - clamp(bloom, 0.0, 1.0));","","    gl_FragColor = base + bloom;","}"].join("\n");this.extractShader=new pc.Shader(e,{attributes:t,vshader:s,fshader:o}),this.blurShader=new pc.Shader(e,{attributes:t,vshader:s,fshader:r}),this.combineShader=new pc.Shader(e,{attributes:t,vshader:s,fshader:i});var a=e.width,l=e.height;this.targets=[];for(var u=0;u<2;u++){var h=new pc.Texture(e,{format:pc.PIXELFORMAT_R8_G8_B8_A8,width:a>>1,height:l>>1});h.minFilter=pc.FILTER_LINEAR,h.magFilter=pc.FILTER_LINEAR,h.addressU=pc.ADDRESS_CLAMP_TO_EDGE,h.addressV=pc.ADDRESS_CLAMP_TO_EDGE;var n=new pc.RenderTarget(e,h,{depth:!1});this.targets.push(n)}this.bloomThreshold=.25,this.blurAmount=4,this.bloomIntensity=1.25,this.sampleWeights=new Float32Array(15),this.sampleOffsets=new Float32Array(30)};return(BloomEffect=pc.inherits(BloomEffect,pc.PostEffect)).prototype=pc.extend(BloomEffect.prototype,{render:function(e,t,s){var o=this.device,r=o.scope;r.resolve("uBloomThreshold").setValue(this.bloomThreshold),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,this.targets[0],this.vertexBuffer,this.extractShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,1/this.targets[1].width,0,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),pc.drawFullscreenQuad(o,this.targets[1],this.vertexBuffer,this.blurShader),calculateBlurValues(this.sampleWeights,this.sampleOffsets,0,1/this.targets[0].height,this.blurAmount),r.resolve("uBlurWeights[0]").setValue(this.sampleWeights),r.resolve("uBlurOffsets[0]").setValue(this.sampleOffsets),r.resolve("uBloomTexture").setValue(this.targets[1].colorBuffer),pc.drawFullscreenQuad(o,this.targets[0],this.vertexBuffer,this.blurShader),r.resolve("uBloomEffectIntensity").setValue(this.bloomIntensity),r.resolve("uBloomTexture").setValue(this.targets[0].colorBuffer),r.resolve("uBaseTexture").setValue(e.colorBuffer),pc.drawFullscreenQuad(o,t,this.vertexBuffer,this.combineShader,s)}}),{BloomEffect:BloomEffect}}());var Bloom=pc.createScript("bloom");Bloom.attributes.add("bloomIntensity",{type:"number",default:1,min:0,title:"Intensity"}),Bloom.attributes.add("bloomThreshold",{type:"number",default:.25,min:0,max:1,precision:2,title:"Threshold"}),Bloom.attributes.add("blurAmount",{type:"number",default:4,min:1,title:"Blur amount"}),Bloom.prototype.initialize=function(){this.effect=new pc.BloomEffect(this.app.graphicsDevice),this.effect.bloomThreshold=this.bloomThreshold,this.effect.blurAmount=this.blurAmount,this.effect.bloomIntensity=this.bloomIntensity;var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("attr",(function(e,t){this.effect[e]=t}),this),this.on("state",(function(t){t?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};pc.extend(pc,function(){var HueSaturationEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uHue;","uniform float uSaturation;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","float angle = uHue * 3.14159265;","float s = sin(angle), c = cos(angle);","vec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;","float len = length(gl_FragColor.rgb);","gl_FragColor.rgb = vec3(","dot(gl_FragColor.rgb, weights.xyz),","dot(gl_FragColor.rgb, weights.zxy),","dot(gl_FragColor.rgb, weights.yzx)",");","float average = (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3.0;","if (uSaturation > 0.0) {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (1.0 - 1.0 / (1.001 - uSaturation));","} else {","gl_FragColor.rgb += (average - gl_FragColor.rgb) * (-uSaturation);","}","}"].join("\n")}),this.hue=0,this.saturation=0};return(HueSaturationEffect=pc.inherits(HueSaturationEffect,pc.PostEffect)).prototype=pc.extend(HueSaturationEffect.prototype,{render:function(t,e,r){var o=this.device,a=o.scope;a.resolve("uHue").setValue(this.hue),a.resolve("uSaturation").setValue(this.saturation),a.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(o,e,this.vertexBuffer,this.shader,r)}}),{HueSaturationEffect:HueSaturationEffect}}());var HueSaturation=pc.createScript("hueSaturation");HueSaturation.attributes.add("hue",{type:"number",default:0,min:-1,max:1,precision:5,title:"Hue"}),HueSaturation.attributes.add("saturation",{type:"number",default:0,min:-1,max:1,precision:5,title:"Saturation"}),HueSaturation.prototype.initialize=function(){this.effect=new pc.HueSaturationEffect(this.app.graphicsDevice),this.effect.hue=this.hue,this.effect.saturation=this.saturation,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var TvScreen=pc.createScript("tvScreen");TvScreen.attributes.add("screenMaterial",{title:"Screen Material",description:"The screen material of the TV that displays the video texture.",type:"asset",assetType:"material"}),TvScreen.attributes.add("playEvent",{title:"Play Event",description:"Set the TV screen material emissive map on this event.",type:"string",default:""}),TvScreen.prototype.initialize=function(){this.app.on(this.playEvent,(function(e){var t=this.screenMaterial.resource;t.diffuseMap=e,t.update()}),this)};var OnButtonClick=pc.createScript("onButtonClick");OnButtonClick.attributes.add("name",{type:"string"}),OnButtonClick.attributes.add("url",{type:"string"}),OnButtonClick.attributes.add("type",{type:"string"}),OnButtonClick.prototype.initialize=function(){var t=this;this.app;this.entity.element.on("click",(function(){void 0!==window.parent.openIframe&&window.parent.openIframe("-"+t.name,t.url,t.type),console.log((t.name,t.url,t.type))})),this.entity.button.on("hoverstart",(function(){t.entity.setLocalScale(1.15,1.15,1.15),document.body.style.cursor="pointer"})),this.entity.button.on("hoverend",(function(){t.entity.setLocalScale(1,1,1),document.body.style.cursor="context-menu"}))},OnButtonClick.prototype.update=function(t){};var Spin=pc.createScript("spin");Spin.attributes.add("speed",{type:"number"}),Spin.prototype.initialize=function(){},Spin.prototype.update=function(t){this.entity.setLocalEulerAngles(0,0,this.entity.getLocalEulerAngles().z+t*this.speed)};pc.extend(pc,function(){var FxaaEffect=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return(FxaaEffect=pc.inherits(FxaaEffect,pc.PostEffect)).prototype=pc.extend(FxaaEffect.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:FxaaEffect}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};var HotspotBtn=pc.createScript("hotspotBtn");HotspotBtn.attributes.add("reachLocation",{type:"entity"}),HotspotBtn.attributes.add("textEl",{type:"entity"}),HotspotBtn.attributes.add("signal",{type:"entity"}),HotspotBtn.attributes.add("groupHandler",{type:"entity"}),HotspotBtn.attributes.add("index",{type:"number"}),HotspotBtn.attributes.add("hoverStart",{type:"asset"}),HotspotBtn.attributes.add("hoverEnd",{type:"asset"}),HotspotBtn.attributes.add("playAudio",{type:"string"}),HotspotBtn.attributes.add("msgOnHover",{type:"string"}),HotspotBtn.attributes.add("isPoster",{type:"boolean",default:!0}),HotspotBtn.attributes.add("rotate",{type:"boolean",default:!0}),HotspotBtn.prototype.initialize=function(){var t=this,e=this.app,o=null;this.entity.on("object:interact",(function(){clearTimeout(o),t.signal&&t.signal.fire("clicked"),void 0!==window.parent.playSoundOneShot&&window.parent.playSoundOneShot("secondaryBtn.wav"),""!==t.playAudio&&void 0!==window.parent.playAudioVoiceover&&setTimeout((function(){window.parent.playAudioVoiceover(t.playAudio)}),300),t.isPoster&&void 0!==window.parent.enablePosterGradient&&window.parent.enablePosterGradient(),t.reachLocation&&(t.rotate?(setTimeout((function(){e.fire("lockCamera"),e.fire("lockMovement"),cameraLerpInstance.updatePos(t.reachLocation.getPosition()),cameraLerpInstance.updateRot(t.reachLocation.getRotation())}),50),o=setTimeout((function(){cameraLerpInstance.endRot(),e.fire("unlockMovement"),e.fire("unlockCamera")}),2500)):(e.fire("endInteraction"),cameraLerpInstance.updatePos(t.reachLocation.getPosition()))),t.groupHandler&&t.groupHandler.script.hotspotGroupHandler.updateValue(t.index)})),this.entity.button&&(this.entity.button.on("click",(function(){clearTimeout(o),t.signal&&t.signal.fire("clicked"),void 0!==window.parent.playSoundOneShot&&window.parent.playSoundOneShot("secondaryBtn.wav"),""!==t.playAudio&&void 0!==window.parent.playAudioVoiceover&&setTimeout((function(){window.parent.playAudioVoiceover(t.playAudio)}),300),t.isPoster&&void 0!==window.parent.enablePosterGradient&&window.parent.enablePosterGradient(),t.reachLocation&&(t.rotate?(setTimeout((function(){e.fire("lockCamera"),e.fire("lockMovement"),cameraLerpInstance.updatePos(t.reachLocation.getPosition()),cameraLerpInstance.updateRot(t.reachLocation.getRotation())}),50),o=setTimeout((function(){cameraLerpInstance.endRot(),e.fire("unlockMovement"),e.fire("unlockCamera")}),2500)):(e.fire("endInteraction"),cameraLerpInstance.updatePos(t.reachLocation.getPosition()))),t.groupHandler&&t.groupHandler.script.hotspotGroupHandler.updateValue(t.index)})),this.entity.button.on("hoverstart",(function(){t.textEl&&(t.textEl.element.text=""+t.msgOnHover),t.entity.setLocalScale(1.1,1.1,1.1),document.body.style.cursor="pointer",t.hoverStart&&(t.entity.element.texture=t.hoverStart.resource),t.entity.script.spin&&(t.entity.script.spin.enabled=!0)})),this.entity.button.on("hoverend",(function(){t.textEl&&(t.textEl.element.text=""),t.entity.setLocalScale(1,1,1),document.body.style.cursor="context-menu",t.hoverStart&&(t.entity.element.texture=t.hoverEnd.resource),t.entity.script.spin&&(t.entity.script.spin.enabled=!1)})))},HotspotBtn.prototype.update=function(t){};var HtmlHandler=pc.createScript("htmlHandler");HtmlHandler.attributes.add("html",{type:"asset",assetType:"html",title:"HTML Asset"}),HtmlHandler.prototype.initialize=function(){},HtmlHandler.prototype.update=function(t){};var VideoTexture=pc.createScript("videoPlayer");VideoTexture.attributes.add("video",{title:"Video",description:"MP4 video asset to play back on this video texture.",type:"asset"}),VideoTexture.attributes.add("playEvent",{title:"Play Event",description:"Event that is fired as soon as the video texture is ready to play.",type:"string",default:""}),VideoTexture.prototype.initialize=function(){var e=this.app,t=document.createElement("video");t.loop=!0,t.muted=!0,t.playsInline=!0,t.crossOrigin="anonymous",t.src=this.video.getFileUrl();var i=t.style;i.width="1px",i.height="1px",i.position="absolute",i.opacity="0",i.zIndex="-1000",i.pointerEvents="none",document.body.appendChild(t),this.videoTexture=new pc.Texture(e.graphicsDevice,{format:pc.PIXELFORMAT_R8_G8_B8,minFilter:pc.FILTER_LINEAR_MIPMAP_LINEAR,magFilter:pc.FILTER_LINEAR,addressU:pc.ADDRESS_CLAMP_TO_EDGE,addressV:pc.ADDRESS_CLAMP_TO_EDGE,mipmaps:!0}),this.videoTexture.setSource(t),t.addEventListener("canplay",function(i){e.fire(this.playEvent,this.videoTexture),t.play()}.bind(this))},VideoTexture.prototype.update=function(e){this.videoTexture.upload()};pc.extend(pc,function(){var BrightnessContrastEffect=function(t){this.shader=new pc.Shader(t,{attributes:{aPosition:pc.SEMANTIC_POSITION},vshader:["attribute vec2 aPosition;","","varying vec2 vUv0;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","    vUv0 = (aPosition.xy + 1.0) * 0.5;","}"].join("\n"),fshader:["precision "+t.precision+" float;","uniform sampler2D uColorBuffer;","uniform float uBrightness;","uniform float uContrast;","varying vec2 vUv0;","void main() {","gl_FragColor = texture2D( uColorBuffer, vUv0 );","gl_FragColor.rgb += uBrightness;","if (uContrast > 0.0) {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) / (1.0 - uContrast) + 0.5;","} else {","gl_FragColor.rgb = (gl_FragColor.rgb - 0.5) * (1.0 + uContrast) + 0.5;","}","}"].join("\n")}),this.brightness=0,this.contrast=0};return(BrightnessContrastEffect=pc.inherits(BrightnessContrastEffect,pc.PostEffect)).prototype=pc.extend(BrightnessContrastEffect.prototype,{render:function(t,e,r){var s=this.device,i=s.scope;i.resolve("uBrightness").setValue(this.brightness),i.resolve("uContrast").setValue(this.contrast),i.resolve("uColorBuffer").setValue(t.colorBuffer),pc.drawFullscreenQuad(s,e,this.vertexBuffer,this.shader,r)}}),{BrightnessContrastEffect:BrightnessContrastEffect}}());var BrightnessContrast=pc.createScript("brightnessContrast");BrightnessContrast.attributes.add("brightness",{type:"number",default:0,min:-1,max:1,precision:5,title:"Brightness"}),BrightnessContrast.attributes.add("contrast",{type:"number",default:0,min:-1,max:1,precision:5,title:"Contrast"}),BrightnessContrast.prototype.initialize=function(){this.effect=new pc.BrightnessContrastEffect(this.app.graphicsDevice),this.effect.brightness=this.brightness,this.effect.contrast=this.contrast,this.on("attr",(function(t,e){this.effect[t]=e}),this);var t=this.entity.camera.postEffects;t.addEffect(this.effect),this.on("state",(function(e){e?t.addEffect(this.effect):t.removeEffect(this.effect)})),this.on("destroy",(function(){t.removeEffect(this.effect)}))};var CssHandler=pc.createScript("cssHandler");CssHandler.attributes.add("css",{type:"asset",assetType:"css",title:"CSS Asset"}),CssHandler.prototype.initialize=function(){var t=document.createElement("link");t.setAttribute("rel","stylesheet"),t.setAttribute("href","https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"),document.head.appendChild(t),this.element=document.createElement("style"),document.head.appendChild(this.element),this.asset=null,this.assetId=0},CssHandler.prototype.attachAsset=function(t,s){if(this.assetId=t,!this.assetId)return s.call(this);var e=this.app.assets.get(this.assetId),a=this;e._onLoad=function(t){s.call(a,t,t.resource)},e.on("load",e._onLoad),s.call(this,e,e.resource),this.app.assets.load(e)},CssHandler.prototype.template=function(t,s){this.asset&&this.asset!==t&&this.asset.off("load",this.asset._onLoad),this.asset=t,this.element.innerHTML=s||""},CssHandler.prototype.update=function(t){this.assetId!==this.css.id&&this.attachAsset(this.css.id,this.template)};pc.script.createLoadingScreen((function(e){var t,o;t=["body {","    background-color: #283538;","}","#application-splash-wrapper {","    position: absolute;","    top: 0;","    left: 0;","    height: 100%;","    width: 100%;","    background-color: #283538;","    display: flex;","    justify-content: center;","    align-items: center;","flex-direction: column;","}","#continueBtn{cursor:pointer;opacity:0.9;}","#continueBtn:hover{cursor:pointer;opacity:1 !important;}","#application-splash {","height: 70%;","padding-bottom: 1rem;","}","#application-splash img {","height: 100%;","}","#progress-bar-container {","    height: 5px;","    width: 30%;","    background-color: white;","}","#progress-bar {","    width: 0%;","    height: 100%;","    background-color: #DD782D;","}","@media (max-width: 480px) {","    #application-splash {","        width: 170px;","        left: calc(50% - 85px);","    }","}",".loop-text {","   position: absolute;","   bottom: calc(50% - 217px);","   width: 65%;","   height: 0rem;","   overflow: hidden;","   color: white;","   display: flex;","   justify-content: center;","   align-items: center;","   text-align:center","opacity:0","display:none;","}",".loop-text p {","  position: absolute;","  height: 30px;","  opacity: 0;","  transition: 0.25s ease-out;","}",".loop-text p.show {","opacity: 1;","  transition: 1.75s ease-out;","}","#centerLogo{transition:750ms}"].join("\n"),(o=document.createElement("style")).type="text/css",o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t)),document.head.appendChild(o),function(){var e=document.createElement("div");e.id="application-splash-wrapper",document.body.appendChild(e),e.style.backgroundImage="url(https://storage.googleapis.com/djzs-bucket/NegotationAcademy/Textures/loaderBG_blurplus.jpg)",e.style.backgroundrepeat="no-repeat",e.style.backgroundSize="cover";var t=document.createElement("div");t.id="application-splash",e.appendChild(t),t.style.display="none";var o=document.createElement("img");o.src="https://storage.googleapis.com/djzs-bucket/NegotationAcademy/Textures/dj_zs_library_instructions_loading.png",o.id="centerLogo",t.appendChild(o),o.onload=function(){t.style.display="block"};var n=document.createElement("img");n.src="/assets/svg/continue.svg",n.id="continueBtn",e.appendChild(n),n.style.display="none",n.onclick=()=>{var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e),void 0!==window.parent.loadingComplete&&window.parent.loadingComplete(),void 0!==window.parent.SocketManager&&window.parent.SocketManager.subscribe_GetSocket((e=>{socketInstance=e,socketInstance&&socketInstance.emit("updateUserLocation","library")})),setTimeout((()=>{void 0!==window.parent.libraryLoadedClickOnKro&&window.parent.libraryLoadedClickOnKro()}),1e3)};var a=document.createElement("div");a.id="progress-bar-container",e.appendChild(a);var i=document.createElement("div");i.id="progress-bar",a.appendChild(i);var r=document.createElement("div");r.classList.add("loop-text"),e.appendChild(r);var l=document.createElement("p");l.innerHTML="<b>Instruction:</b> Click on floor or use WASD keys to navigate.",r.appendChild(l);var c=document.createElement("p");c.innerHTML="<b>Instruction:</b> You can enter the Breakout, Plenary, and Negotiation Room through the side folded menu on the top left.",r.appendChild(c);var d=document.createElement("p");d.innerHTML="<b>Instruction:</b> To interact with a guest, click on their avatar.",r.appendChild(d)}();let n=document.querySelectorAll(".loop-text p"),a=null,animate=(e,t)=>{let o=(t+1)%n.length;a&&(a.className=""),e.className="show",a=e,setTimeout((()=>{a&&(a.className=""),e.className="show",a=e,animate(n[o],o)}),3500)};animate(n[0],0);e.on("preload:end",(function(){e.off("preload:progress")})),e.on("preload:progress",(function(e){var t=document.getElementById("progress-bar");t&&(e=Math.min(1,Math.max(0,e)),t.style.width=100*e+"%")})),e.on("start",(function(){if("true"==window.localStorage.getItem("libraryFirst")){window.localStorage.setItem("libraryFirst","false"),document.getElementById("continueBtn").style.display="block",document.getElementById("progress-bar-container").style.display="none"}else{var e=document.getElementById("application-splash-wrapper");e.parentElement.removeChild(e),void 0!==window.parent.loadingComplete&&window.parent.loadingComplete(),setTimeout((()=>{void 0!==window.parent.libraryLoadedClickOnKro&&window.parent.libraryLoadedClickOnKro()}),1e3),void 0!==window.parent.SocketManager&&window.parent.SocketManager.subscribe_GetSocket((e=>{socketInstance=e,socketInstance&&socketInstance.emit("updateUserLocation","library")}))}}))}));var soundHandler,HandleSound=pc.createScript("handleSound");function volumeSetKrdo(n){soundHandler.setVolume(n)}HandleSound.prototype.initialize=function(){soundHandler=this,this.setVolume(0)},HandleSound.prototype.update=function(n){},HandleSound.prototype.setVolume=function(n){this.app.systems.sound.volume=n};var Ripple=pc.createScript("ripple");Ripple.attributes.add("speed",{type:"number",default:1}),Ripple.attributes.add("startingValue",{type:"number",default:.1}),Ripple.prototype.initialize=function(){this.scale=this.startingValue,this.entity.element.opacity=this.startingValue-.1},Ripple.prototype.update=function(t){this.entity.element.opacity>0?(this.entity.element.opacity-=t*this.speed,this.scale+=t*this.speed,this.entity.setLocalScale(this.scale,this.scale,this.scale)):(this.scale=.1,this.entity.setLocalScale(this.scale,this.scale,this.scale),this.entity.element.opacity=1)};var OpenSurveyForm=pc.createScript("openSurveyForm");OpenSurveyForm.attributes.add("name",{type:"string"}),OpenSurveyForm.prototype.initialize=function(){var t=this;this.app;this.entity.element.on("click",(function(){console.log("opening form-"+t.name),void 0!==window.parent.activateForm&&window.parent.activateForm("form-"+t.name)})),this.entity.button.on("hoverstart",(function(){t.entity.setLocalScale(1.15,1.15,1.15),document.body.style.cursor="pointer"})),this.entity.button.on("hoverend",(function(){t.entity.setLocalScale(1,1,1),document.body.style.cursor="context-menu"}))},OpenSurveyForm.prototype.update=function(t){};var EnableClicking=pc.createScript("enableClicking");let enableClickz=null;EnableClicking.prototype.initialize=function(){enableClickz=this},window.parent.libraryLoadedClickOnKro=()=>{enableClickz.clickKrneDo()},EnableClicking.prototype.clickKrneDo=function(){this.entity.script.pointAndClick.enabled=!0},EnableClicking.prototype.update=function(i){};