(this["webpackJsonpvirtual-event"]=this["webpackJsonpvirtual-event"]||[]).push([[0],{102:function(e,t,a){},109:function(e,t,a){e.exports=a(248)},114:function(e,t,a){},116:function(e,t,a){},248:function(e,t,a){"use strict";a.r(t);var n=a(1),o=a.n(n),i=a(103),r=a.n(i),s=(a(114),a(4)),c=a.n(s),l=a(10),u=a(15),d=a(18),m=a(3),h=a(20),p=a(19),f=(a(116),o.a.createContext(null)),v=f,g=a(16),b=a(12),S=a.n(b);a(117),a(118),a(120),a(121);S.a.initializeApp({apiKey:"AIzaSyCneEInwQf9s42gCzrX1ybhEvqO8Z1FcjM",authDomain:"broad-expo-rent-dj.firebaseapp.com",databaseURL:"https://broad-expo-rent-dj.firebaseio.com",projectId:"broad-expo-rent-dj",storageBucket:"broad-expo-rent-dj.appspot.com",messagingSenderId:"60481384412",appId:"1:60481384412:web:d39202acf4d3a9df266919",measurementId:"G-N8YN11228Z"});var k=function e(){var t=this;Object(u.a)(this,e),this.user_AnalyticsHandler=function(){var e=Object(l.a)(c.a.mark((function e(a,n){var o,i,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{"Meeting"===a&&"enter"===n?(o=0,t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Meeting_Visit_Count").once("value").then((function(e){o=e.val(),o++,t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Meeting_Visit_Count").set(o),t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Current_Room").set("Meeting")}))):"Meeting"===a&&"exit"===n?t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Current_Room").set("none"):"Call"===a&&"enter"===n?(o=0,t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Meeting_Visit_Count").once("value").then((function(e){o=e.val(),o++,t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Meeting_Visit_Count").set(o),t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Current_Room").set("Call")}))):"Call"===a&&"exit"===n&&t.database.ref("/user_analytics/"+t.auth.currentUser.uid+"/Current_Room").set("none")}catch(s){i=s.code,r=s.message,console.log("code: "+i+" & ErrorMsg: "+r)}case 1:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.saveMeetingRoomData=function(e){var a=t;e.forEach((function(e){a.saveSingleMeetingRoomData(e.name,e.id,e.slots)}))},this.saveSingleMeetingRoomData=function(){var e=Object(l.a)(c.a.mark((function e(t,a,n){var o,i,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=S.a.firestore(),i=a+"_"+t,r=o.collection("meetingRoom").doc(i),e.next=6,r.set({id:a,name:t,slots:n});case 6:console.log("dataSaved"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t,a,n){return e.apply(this,arguments)}}(),this.getMeetingRoomData=Object(l.a)(c.a.mark((function e(){var a,n,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=[],n=S.a.firestore(),o=n.collection("meetingRoom"),e.next=6,o.get();case 6:i=e.sent,console.log(i),i.empty||(i.docs.forEach((function(e){var t=e.data(),n={};n.id=t.id,n.name=t.name,n.slots=t.slots,a.push(n)})),t.meetingRooms=a,console.log(t.meetingRooms)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),this.attachMeetingRoomListener=function(){var e=t;S.a.firestore().collection("meetingRoom").onSnapshot((function(t){var a=[];t.empty||(t.docs.forEach((function(e){var t=e.data(),n={};n.id=t.id,n.name=t.name,n.slots=t.slots,a.push(n)})),e.meetingRooms=a,e.updateMeetingRooms())}),(function(e){console.log(e)}))},this.updateMeetingRoomDataAccLimit=function(e,a,n,o,i){console.log(e,n,o);var r=a+"_"+e,s=t.meetingRooms.filter((function(e){return e.id==a}))[0];console.log(s);s.slots.forEach((function(e,t){e.id===n&&t}));t.getUserId(t.currentUser,!0);var c=S.a.firestore(),l=c.collection("meetingRoom").doc(r);return c.runTransaction((function(e){return e.get(l).then((function(e){if(!e.exists)throw"Document does not exist!";var t=e.data().slots,a=-1;if(t.forEach((function(e,t){e.id===n&&(a=t)})),-1===a)throw{code:"noSlot",messgage:"slot not foun"}}))})).then((function(){console.log("Transaction successfully committed!"),i&&i()})).catch((function(e){console.log("Transaction failed: ",e),i&&i(e)}))},this.updateMeetingRoomData=function(e,a,n,o,i){console.log(e,n,o);var r=a+"_"+e,s=t.meetingRooms.filter((function(e){return e.id==a}))[0];console.log(s);var c=-1;s.slots.forEach((function(e,t){e.id===n&&(c=t)})),-1!==c&&(s.slots[c].available=o,s.slots[c].userId=o?"":t.getUserId(t.currentUser,!0));var l=S.a.firestore(),u=l.collection("meetingRoom").doc(r);return l.runTransaction((function(e){return e.get(u).then((function(t){if(!t.exists)throw"Document does not exist!";if(o)return e.update(u,{slots:s.slots});var a=t.data().slots,i=-1;if(a.forEach((function(e,t){e.id===n&&(i=t)})),-1!==i){if(a[i].available)return e.update(u,{slots:s.slots});throw"slot not avalilable"}}))})).then((function(){console.log("Transaction successfully committed!"),i&&i()})).catch((function(e){console.log("Transaction failed: ",e),i&&i(e)}))},this.getMeetingOfficalsData=Object(l.a)(c.a.mark((function e(){var a,n,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=S.a.firestore(),n=a.collection("meetingRoomOfficials"),e.next=5,n.where("members","array-contains",t.currentUser.email).get();case 5:o=e.sent,console.log(t.currentUser.uid),o.empty?(t.isOffical=!1,console.log("Not meeting room offical")):(t.isOffical=!0,console.log("found meeting room offical")),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),this.getUserId=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a="";return e.phoneNumber?a="".concat(e.phoneNumber):null!==e.email&&(a=(a=e.email).toLowerCase(),t||(a=a.replace(/[&\/\\#,+$~%.'":*?<>{}]/g,""))),a},this.getCurrentTimeStampV2=function(){return new Promise(function(){var e=Object(l.a)(c.a.mark((function e(t,a){var n,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("https://dj-timeserver.glitch.me/date");case 3:return n=e.sent,e.next=6,n.json();case 6:o=e.sent,window.date=o.date,t(o),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),a(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(t,a){return e.apply(this,arguments)}}())},this.getDate=function(){return new Promise(function(){var e=Object(l.a)(c.a.mark((function e(a,n){var o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!window.date){e.next=5;break}a(window.date),e.next=10;break;case 5:return e.next=7,t.getCurrentTimeStampV2();case 7:o=e.sent,window.date=o.date,a(window.date);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),n(e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,a){return e.apply(this,arguments)}}())},this.addHotspotAnalytics=function(){var e=Object(l.a)(c.a.mark((function e(a,n){var o,i,r;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=3;break}return console.error("videoCallId is null"),e.abrupt("return");case 3:return console.log(a),o=window.userId?window.userId:t.getUserId(n),e.next=7,t.getDate();case 7:i=e.sent,r="/userAnalytics/".concat(i,"/").concat(o,"/videoCall"),t.database.ref(r).update(Object(g.a)({},a,S.a.database.ServerValue.increment(1)));case 11:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),this.signInWithId=function(e,a){return new Promise(function(){var n=Object(l.a)(c.a.mark((function n(o,i){var r;return c.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,t.auth.signInWithEmailAndPassword(e,a);case 3:r=n.sent,console.log(r.user.email+" is logged in right now"),o(),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(0),i(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e,t){return n.apply(this,arguments)}}())},this.defaultImageUrl="https://firebasestorage.googleapis.com/v0/b/djfarmademo.appspot.com/o/profileimages%2Fblank-avatar.png?alt=media&token=2af15226-9bd7-47ce-bc72-f3c1a12a0780",this.signUpWithId=function(e,a,n){return new Promise(function(){var o=Object(l.a)(c.a.mark((function o(i,r){var s;return c.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,t.auth.createUserWithEmailAndPassword(e,a);case 3:return s=o.sent,console.log(s.user.email+" is signedUp in right now"),o.next=7,s.user.updateProfile({displayName:n,photoURL:t.defaultImageUrl});case 7:i(),o.next=13;break;case 10:o.prev=10,o.t0=o.catch(0),r(o.t0);case 13:case"end":return o.stop()}}),o,null,[[0,10]])})));return function(e,t){return o.apply(this,arguments)}}())},this.loadUser=function(){var e=Object(l.a)(c.a.mark((function e(a,n,o){var i,r=arguments;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=r.length>3&&void 0!==r[3]&&r[3],r.length>4?r[4]:void 0,e.abrupt("return",new Promise(function(){var e=Object(l.a)(c.a.mark((function e(r,s){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.signInWithId(a,n);case 3:r(),e.next=19;break;case 6:if(e.prev=6,e.t0=e.catch(0),"auth/user-not-found"!==e.t0.code||!i){e.next=18;break}return e.prev=9,e.next=12,t.signUpWithId(a,n,o);case 12:return e.abrupt("return");case 15:e.prev=15,e.t1=e.catch(9),"NoUserFound"===e.t1.code&&s(e.t1);case 18:s({code:e.t0.code,message:e.t0.message});case 19:case"end":return e.stop()}}),e,null,[[0,6],[9,15]])})));return function(t,a){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),this.app=S.a,this.auth=S.a.auth(),this.db=S.a.firestore(),this.firestore=S.a.firestore(),this.database=S.a.database(),window.FirebaseObj=this,this.currentUser=null,this.meetingRooms=null,this.updateMeetingRooms=null,this.isOffical=!1,this.getCurrentTimeStampV2()},y=a(108),w=a(104),E=(n.Component,a(107)),C=a(31),R=a(105),x=a.n(R),I=a(30),L=a.n(I);function M(e){var t="";if(e){var a=e.trim().split(" ");return a.length>0?a.forEach((function(e){t+=e[0]})):t=e[0],t.toUpperCase()}return" "}var _=function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(u.a)(this,a),(n=t.call(this,e)).disconnectAndShowPopup=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;console.log(n.state.isSlotAvailable,"///////////////////"),n.forceExit=!1,e?n.props.showInfoPopUp(t):n.props.showBusyPopup()},n.checkSlotAvailable=function(){return console.log(n.state.isSlotAvailable,"///////////////////"),console.log(n.state.clientIdentity,n.props.userId),!(!n.props.isOfficial&&!n.state.isSlotAvailable&&n.state.clientIdentity!==n.props.userId)||(n.disconnectAndShowPopup(),!1)},n.checkIfSlotAlreadyTaken=function(){var e=Object(m.a)(n);return console.log(e.state.isSlotAvailable,"///////////////////"),console.log(e.state.clientIdentity,e.props.userId),!(!n.props.isOfficial&&!e.state.isSlotAvailable&&e.state.clientIdentity!==e.props.userId)||(e.forceExit=!0,e.leaveRoom(),e.props.showBusyPopup(),!1)},n.processProps=function(e){console.log("updated!!!!");var t=e.liveRooms.filter((function(t){return t.id==e.room.roomParentId}))[0].slots.filter((function(t){return t.id==e.room.roomId}))[0],a=t.available,o=t.userId;a?n.setState({isSlotAvailable:a,clientIdentity:o,showRest:!1}):n.setState({isSlotAvailable:a,clientIdentity:o})},n.checUserPresence=function(e){if(!n.state.isSlotAvailable&&n.state.clientIdentity.length>0){var t=Object(m.a)(n),a=!1;console.log("searching for "+t.state.clientIdentity),e.forEach((function(e){e.identity==t.state.clientIdentity&&(a=!0,console.log(e.identity))})),a?console.log("user is still here"):(console.log("user might me disconnected,"),console.log("ResetSlot"),t.state.isSlotAvailable?console.log("No need to show resetButton"):(t.setState({showRest:!0}),t.props.slotReset()))}},n.getParticipantClass=function(e,t){var a=t;Object.keys(n.state.participants).length>Object.keys(a).length&&(a=n.state.participants);for(var o=Object.keys(a),i=0;i<o.length;i++)if(e.sid===a[o[i]].sid)return"CallBox_".concat(i+2);return"CallBox_".concat(o.length+1)},n.freeParticipantClass=function(e){for(var t=Object.keys(n.callboxMap),a=0;a<t.length;a++)if(console.log(e,n.callboxMap[t[a]]),n.callboxMap[t[a]]===e.sid)return void(n.callboxMap=Object(C.a)(Object(C.a)({},n.callboxMap),{},Object(g.a)({},t[a],null)))},n.getParticipantClassUsingMap=function(e){for(var t=Object.keys(n.callboxMap),a=0;a<t.length;a++)if(!n.callboxMap[t[a]])return n.callboxMap=Object(C.a)(Object(C.a)({},n.callboxMap),{},Object(g.a)({},t[a],e.sid)),console.log(t[a],n.callboxMap[t[a]]),"CallBox_".concat(t[a]);return"CallBox_4"},n.participantLeaveRoom=function(e){if(n.state.participants.length>0){var t=n.state.participants;t=t.filter((function(t){return t.sid!=e.sid})),n.props.isOfficial||0!=t.length||n.props.showPopup(),n.freeParticipantClass(e),n.setState({participants:t})}else n.setState({wegotourselfacall:!1});if(n.props.isOfficial&&(console.log("Participant '"+e.identity+"' left the room"),console.log("Client id => '"+n.state.clientIdentity+" "),e.identity===n.state.clientIdentity)){var a=Object(m.a)(n);setTimeout((function(){a.state.isSlotAvailable?console.log("No need to show resetButton"):(console.log("we should wait for 20 moreSeconds "),a.setState({showRest:!0}),a.props.slotReset())}),8e3)}document.getElementById(e.sid).remove()},n.participantDisconnected=function(e){if(n.state.participants.length>0){var t=n.state.participants;t=t.filter((function(t){return t.sid!=e.sid})),n.setState({participants:t})}console.log("Participant '"+e.identity+"' left the room"),console.log("Client id => '"+n.state.clientIdentity+" "),document.getElementById(e.sid).remove(),n.freeParticipantClass(e)},n.openWhiteboardLayout=function(){var e=document.querySelector("#overlayContent");e.classList.contains(n.currentLayoutClass)&&e.classList.remove(n.currentLayoutClass),e.classList.add("caller_whiteboard")},n.closeWhiteboardLayout=function(){var e=document.querySelector("#overlayContent");e.classList.contains("caller_whiteboard")&&e.classList.remove("caller_whiteboard"),e.classList.add(n.currentLayoutClass)},n.handleWhiteBoardButton=function(e,t){e.preventDefault(),n.setState({showWhiteborad:t});var a=document.querySelector("#overlayContent");a.classList.contains("caller_4")&&a.classList.remove("caller_4");t?(a.classList.contains(n.currentLayoutClass)&&a.classList.remove(n.currentLayoutClass),a.classList.add("caller_whiteboard")):(a.classList.contains("caller_whiteboard")&&a.classList.remove("caller_whiteboard"),a.classList.add(n.currentLayoutClass))},n.state={identity:null,roomId:e.room.roomId,roomName:e.room.roomName,roomIdErr:!1,previewTracks:null,localMediaAvailable:!1,hasJoinedRoom:!1,activeRoom:null,audioEnabled:!0,videoEnabled:!1,screenShared:!1,remoteScreenShared:!1,participants:[],remoteScreens:[],screenTrack:null,remoteScreenTrack:null,showNotification:!1,isSlotAvailable:!1,currentParticipant:null,clientIdentity:"",showRest:!1,wegotourselfacall:!1},n.currentLayoutClass="caller_8",n.callboxMap={2:null,3:null,4:null,5:null,6:null,7:null,8:null},n.localMedia=null,n.remoteMedia=null,n.timerRef=null,n.forceExit=!1,n.setLocalMediaRef=function(e){n.localMedia=e},n.setRemoteMediaRef=function(e){n.remoteMedia=e},n.joinRoom=n.joinRoom.bind(Object(m.a)(n)),n.leaveRoom=n.leaveRoom.bind(Object(m.a)(n)),n.roomJoined=n.roomJoined.bind(Object(m.a)(n)),n.attachLocalParticipantTracks=n.attachLocalParticipantTracks.bind(Object(m.a)(n)),n.onCameraButtonClick=n.onCameraButtonClick.bind(Object(m.a)(n)),n.onAudioButtonClick=n.onAudioButtonClick.bind(Object(m.a)(n)),n.shareScreen=n.shareScreen.bind(Object(m.a)(n)),n.handleTrackEnabled=n.handleTrackEnabled.bind(Object(m.a)(n)),n.participantConnected=n.participantConnected.bind(Object(m.a)(n)),n.participantDisconnected=n.participantDisconnected.bind(Object(m.a)(n)),n.trackSubscribed=n.trackSubscribed.bind(Object(m.a)(n)),n.trackUnsubscribed=n.trackUnsubscribed.bind(Object(m.a)(n)),n.handleParticipantTrackEnabled=n.handleParticipantTrackEnabled.bind(Object(m.a)(n)),n.handleParticipantTrackDisabled=n.handleParticipantTrackDisabled.bind(Object(m.a)(n)),n.stopLocalScreenShare=n.stopLocalScreenShare.bind(Object(m.a)(n)),n.startScreenShare=n.startScreenShare.bind(Object(m.a)(n)),n._startScreenCapture=n._startScreenCapture.bind(Object(m.a)(n)),n.handleLocalSharedScreen=n.handleLocalSharedScreen.bind(Object(m.a)(n)),n.handleRemoteSharedScreen=n.handleRemoteSharedScreen.bind(Object(m.a)(n)),n.stopRemoteSharedScreen=n.stopRemoteSharedScreen.bind(Object(m.a)(n)),n.openFullscreen=n.openFullscreen.bind(Object(m.a)(n)),n.onCallDisconnect=n.onCallDisconnect.bind(Object(m.a)(n)),n.showNotification=n.showNotification.bind(Object(m.a)(n)),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.processProps(this.props),window.parent.leaveTheCall=this.leaveTheCall.bind(this);var t=window.location.href.split("$")[1];console.log(t),null!=t&&this.setState({roomId:t}),x.a.post("https://twiliovideocall.djvirtualevents.com/api/token",{name:this.props.userName}).then((function(t){if(e.checkSlotAvailable()){var a=t.data,n=a.identity,o=a.token;return e.setState({identity:n,token:o}),void e.joinRoom()}}))}},{key:"componentWillReceiveProps",value:function(e){e&&this.processProps(e)}},{key:"onCallDisconnect",value:function(){this.props.onCallDisconnect&&this.props.onCallDisconnect(this.forceExit)}},{key:"showNotification",value:function(e){var t=this;this.setState({notification:e}),this.setState({showNotification:!0}),setTimeout((function(){t.setState({showNotification:!1}),t.setState({notification:null})}),e.timeout)}},{key:"joinRoom",value:function(){if(this.checkSlotAvailable())if(this.state.roomId.trim()){console.log("Joining room '"+this.state.roomId+"'...");var e={name:this.state.roomId,audio:!0,video:{width:{min:640,ideal:640,max:1280},height:{min:360,ideal:360,max:720},aspectRatio:1.77,frameRate:{max:30}}};this.state.previewTracks&&(e.tracks=this.state.previewTracks);var t=this;L.a.connect(this.state.token,e).then(this.roomJoined,(function(e){console.log(e),t.disconnectAndShowPopup(!0,"".concat(0===e.code?"Camera ":""," ").concat(e.message))}))}else this.setState({roomIdErr:!0})}},{key:"roomJoined",value:function(e){var t=this;console.log("Joined as '"+this.state.identity+"'"),this.setState({activeRoom:e,localMediaAvailable:!0,hasJoinedRoom:!0}),this.state.activeRoom.localParticipant.videoTracks.forEach((function(e){"screen"!=e.track.name&&e.track.disable()})),this.state.activeRoom.localParticipant.audioTracks.forEach((function(e){e.track.enable()}));var a=this.localMedia;a.querySelector("video")||this.attachLocalParticipantTracks(e.localParticipant,a);if(e.participants.forEach((function(e){t.participantConnected(e)})),e.on("participantConnected",(function(e){return t.participantConnected(e)})),e.on("participantDisconnected",(function(e){return t.participantLeaveRoom(e)})),e.on("disconnected",(function(){t.state.previewTracks&&t.state.previewTracks.forEach((function(e){e.stop()})),e.localParticipant.tracks.forEach((function(e){e.track.stop(),e.track.detach().forEach((function(e){return e.remove()}))})),e.participants.forEach((function(e){return t.participantDisconnected(e)})),t.state.activeRoom=null,t.setState({hasJoinedRoom:!1,localMediaAvailable:!1}),t.onCallDisconnect()})),this.checkIfSlotAlreadyTaken()){this.props.updateRoomStatus();var n=this;setTimeout((function(){n.checkIfSlotAlreadyTaken()}),1500),this.props.isOfficial?this.checUserPresence(e.participants):0===e.participants.size&&this.props.showPopup()}}},{key:"participantConnected",value:function(e){var t,a,n=this;console.log(e);var o=this.state.participants;if(o.push(e),this.setState({participants:o}),console.log(o.length),console.log("agagagaGag"+this.state.wegotourselfacall),o.length>0&&(this.setState({wegotourselfacall:!0}),console.log(this.state.wegotourselfacall)),o.length>3){var i=document.querySelector("#overlayContent");i.classList.contains("caller_4")&&i.classList.remove("caller_4"),i.classList.contains("caller_8")||(i.classList.add("caller_8"),this.currentLayoutClass="caller_8")}var r=document.createElement("div");r.id=e.sid,r.classList.add("callingBox__video"),r.classList.add("callbox_d"),r.classList.add(this.getParticipantClassUsingMap(e));var s=document.createElement("div");s.classList.add("callingBox__video-container");var c=document.createElement("span");c.id="caller-name",c.classList.add("callingBox__nameTag");var l="userInital--color"+(2*Math.floor(Math.random())+1);c.classList.add(l);var u=e.identity,d=new RegExp(/(\p{L}{1})\p{L}+/,"gu"),m=Object(E.a)(u.matchAll(d))||[];m=(((null===(t=m.shift())||void 0===t?void 0:t[1])||"")+((null===(a=m.pop())||void 0===a?void 0:a[1])||"")).toUpperCase(),c.innerText=M(e.identity),s.appendChild(c);var h=document.createElement("span");h.id="caller-name",h.classList.add("username-bar"),h.innerText=e.identity,s.appendChild(h);var p=document.createElement("button");p.classList.add("icon-btn");var f=document.createElement("i");f.classList.add("icon-speaker"),p.appendChild(f),s.appendChild(p);var v=document.createElement("div");v.id="video",v.classList.add("callingBox__video-wrapper"),v.classList.add("has-video"),s.appendChild(v),r.appendChild(s),this.remoteMedia.appendChild(r),e.tracks.forEach((function(e){e.track&&n.trackSubscribed([e.track],v),e.on("subscribed",n.handleTrackEnabled)})),e.on("trackSubscribed",(function(e){"video"==e.kind?v.setAttribute("videoId",e.sid):v.setAttribute("audioId",e.sid),n.trackSubscribed([e],v)})),e.on("trackUnsubscribed",(function(e){n.stopRemoteSharedScreen([e])}))}},{key:"trackSubscribed",value:function(e,t){var a=this;e.forEach((function(e){"screen"!=e.name?(t.appendChild(e.attach()),e.isEnabled?a.handleParticipantTrackEnabled(e):a.handleParticipantTrackDisabled(e)):(a.handleRemoteSharedScreen([e]),a.stopLocalScreenShare())}))}},{key:"attachLocalParticipantTracks",value:function(e,t){Array.from(e.tracks.values()).forEach((function(e){t.appendChild(e.track.attach())}))}},{key:"leaveRoom",value:function(){"undefined"!==typeof window.parent.leaveCall&&window.parent.leaveCall()}},{key:"leaveTheCall",value:function(){this.state.activeRoom&&(this.state.activeRoom.disconnect(),this.setState({hasJoinedRoom:!1,localMediaAvailable:!1}))}},{key:"handleTrackEnabled",value:function(e){var t=this;e.on("enabled",(function(){return t.handleParticipantTrackEnabled(e)})),e.on("disabled",(function(){return t.handleParticipantTrackDisabled(e)}))}},{key:"handleParticipantTrackEnabled",value:function(e){if("video"==e.kind){var t=document.querySelector('[videoid="'.concat(e.sid,'"]'));t.parentElement.classList.remove("callingBox__video-container--audio"),t.classList.remove("d-none")}"audio"==e.kind&&(document.querySelector('[audioid="'.concat(e.sid,'"]')).parentElement.firstChild.classList.add("user-speaking"),document.querySelector('[audioid="'.concat(e.sid,'"]')).parentElement.childNodes[1].classList.add("active"))}},{key:"handleParticipantTrackDisabled",value:function(e){if("video"==e.kind){var t=document.querySelector('[videoid="'.concat(e.sid,'"]'));t.parentElement.classList.add("callingBox__video-container--audio"),t.classList.add("d-none")}"audio"==e.kind&&(document.querySelector('[audioid="'.concat(e.sid,'"]')).parentElement.firstChild.classList.remove("user-speaking"),document.querySelector('[audioid="'.concat(e.sid,'"]')).parentElement.childNodes[1].classList.remove("active"))}},{key:"onCameraButtonClick",value:function(e){e.preventDefault(),this.state.activeRoom&&(this.state.videoEnabled?this.state.activeRoom.localParticipant.videoTracks.forEach((function(e){"screen"!=e.track.name&&e.track.disable()})):this.state.activeRoom.localParticipant.videoTracks.forEach((function(e){"screen"!=e.track.name&&e.track.enable()})),this.setState({videoEnabled:!this.state.videoEnabled}))}},{key:"onAudioButtonClick",value:function(e){e.preventDefault(),this.state.activeRoom&&(this.state.audioEnabled?this.state.activeRoom.localParticipant.audioTracks.forEach((function(e){e.track.disable()})):this.state.activeRoom.localParticipant.audioTracks.forEach((function(e){e.track.enable()})),this.setState({audioEnabled:!this.state.audioEnabled}))}},{key:"onHangUpButtonClick",value:function(e){e.preventDefault(),"undefined"!==typeof window.parent.leavevRoomCallNow&&window.parent.leavevRoomCallNow()}},{key:"shareScreen",value:function(e){e.preventDefault(),this.state.activeRoom&&(null==this.state.screenTrack?this.startScreenShare():this.stopLocalScreenShare())}},{key:"_startScreenCapture",value:function(){return navigator.getDisplayMedia?navigator.getDisplayMedia({video:!0}):navigator.mediaDevices.getDisplayMedia?navigator.mediaDevices.getDisplayMedia({video:!0}):navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}})}},{key:"startScreenShare",value:function(){var e=this,t=this;if(this.state.remoteScreens.length>0)return console.log("Already Shared"),void this.showNotification({line1:"You can't Share Screen right now.",line2:"Someone is already sharing.",timeout:1e4});this._startScreenCapture().then((function(a){var n=a.getAudioTracks().map((function(e){return new I.LocalAudioTrack(e)})),o=a.getVideoTracks().map((function(e){return new I.LocalVideoTrack(e,{name:"screen"})})),i=n.concat(o);t.handleLocalSharedScreen(i),a.getTracks()[0].onended=function(){return t.stopLocalScreenShare()},e.openWhiteboardLayout()}))}},{key:"stopRemoteSharedScreen",value:function(e){var t=this.state.remoteScreens;e.forEach((function(e){e.detach().forEach((function(e){return e.remove()})),t=t.filter((function(t){return e.id!=t.id}))})),this.closeWhiteboardLayout(),this.setState({remoteScreens:t}),this.setState({remoteScreenShared:!1})}},{key:"handleRemoteSharedScreen",value:function(e){var t=this.state.remoteScreens;e.forEach((function(e){document.getElementById("screen-share").appendChild(e.attach()),t.push(e)})),this.openWhiteboardLayout(),this.setState({remoteScreens:t}),this.setState({remoteScreenShared:!0}),this.setState({showWhiteborad:!1})}},{key:"handleLocalSharedScreen",value:function(e){this.setState({screenTrack:e}),this.state.activeRoom.localParticipant.publishTracks(e),this.setState({screenShared:!0}),e.forEach((function(e){document.getElementById("screen-share").appendChild(e.attach())}))}},{key:"stopLocalScreenShare",value:function(){try{this.state.activeRoom&&this.state.screenTrack&&this.state.screenShared&&(this.state.activeRoom.localParticipant.unpublishTracks(this.state.screenTrack),this.state.screenTrack.forEach((function(e){e.stop(),e.detach().forEach((function(e){return e.remove()}))})),this.closeWhiteboardLayout(),this.setState({screenTrack:null}),this.setState({screenShared:!1}))}catch(e){console.error(e)}}},{key:"trackUnsubscribed",value:function(e){e.detach().forEach((function(e){return e.remove()}))}},{key:"openFullscreen",value:function(){var e=document.getElementById("screen-share").children[1];e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}},{key:"render",value:function(){var e=this,t=this.state.participants.length+1;var a=this.state.remoteScreens.length>0;return o.a.createElement(o.a.Fragment,null,o.a.createElement("section",{className:"callingBox"},this.state.showNotification&&o.a.createElement("div",{className:"call-end-notification"},this.state.notification.line1,o.a.createElement("span",null,this.state.notification.line2)),o.a.createElement("div",{className:"main3DContainer",ref:this.main3dContainer},o.a.createElement("div",{id:"child3DContainer",ref:this.child3dContainer,style:this.state.child3dContainerStyle},o.a.createElement("div",{id:"overlayContent",style:{height:"calc(100vh - 5rem)",width:"calc(100vh * 2.33)"},ref:this.setRemoteMediaRef,className:"caller_8"},o.a.createElement("div",{className:"callingBox__video CallBox_1 callbox_d",style:{display:"block"}},o.a.createElement("div",{className:"callingBox__video-container ".concat(this.state.videoEnabled?" ":" callingBox__video-container--audio ")},o.a.createElement("span",{className:"callingBox__nameTag ".concat(this.state.audioEnabled?" user-speaking ":""," ")}," ",this.context.displayName?M(this.context.displayName):"You"),o.a.createElement("span",{className:"username-bar"},"You"),o.a.createElement("div",{className:"callingBox__video-wrapper has-video ".concat(this.state.videoEnabled?"":"d-none"),id:"local-media",ref:this.setLocalMediaRef}))),o.a.createElement("div",{id:"loadingPPL",className:"callingBox__video CallBox_2 callbox_d",style:{display:this.state.wegotourselfacall?"none":"block"}},o.a.createElement("div",{className:"nouser"},o.a.createElement("div",{style:{textAlign:"center",fontSize:"1rem",margin:"0px 3rem"}},"Wating for others to join..."))),o.a.createElement("div",{className:"shared-screenBox has-video ".concat(this.state.screenShared||a?"active":""),id:"screen-share"},o.a.createElement("button",{className:"full-screen-btn",onClick:this.openFullscreen},o.a.createElement("i",{className:"icon-full-screen"}))),this.state.showWhiteborad&&o.a.createElement("div",{className:"whiteboardContainer"},o.a.createElement("div",{className:"whiteboardHeader"},o.a.createElement("div",null,"ZS Discussion Board"),o.a.createElement("img",{alt:"",src:"/assets/images/Cross.png",onClick:function(t){return e.handleWhiteBoardButton(t,!1)}})),o.a.createElement("div",{class:"blocker platformStart"},o.a.createElement("div",{class:"lds-dual-ring"}),o.a.createElement("div",null,"Loading...")))))),o.a.createElement("div",{className:"callingBox__buttons callingBox__buttons__gradient"},o.a.createElement("ul",{className:"callingBox__buttons-list"},o.a.createElement("li",null,o.a.createElement("button",{className:"icon-btn",onClick:this.onCameraButtonClick,style:this.state.videoEnabled?{backgroundColor:"rgb(111 111 111)"}:{backgroundColor:"rgb(150 150 150)"}},o.a.createElement("i",{className:this.state.videoEnabled?"icon-video-btn":"icon-video-btn-mute"}))),o.a.createElement("li",{style:{display:"none"}},o.a.createElement("button",{className:"icon-btn icon-btn--red",onClick:this.leaveRoom},o.a.createElement("i",{className:"icon-phone"}))),o.a.createElement("li",null,o.a.createElement("button",{className:"icon-btn",onClick:this.onAudioButtonClick,style:this.state.audioEnabled?{backgroundColor:"rgb(111 111 111)"}:{backgroundColor:"rgb(150 150 150)"}},o.a.createElement("i",{className:this.state.audioEnabled?"icon-mic-btn":"icon-mic-btn-mute"}))),o.a.createElement("li",null,o.a.createElement("button",{className:"icon-btn",onClick:this.onHangUpButtonClick,style:{backgroundColor:"rgb(111 111 111)"}},o.a.createElement("i",{className:"icon-end-call"})))),o.a.createElement("div",null))))}}]),a}(n.Component);_.contextType=v;var j=_,N=a(106),O=a.n(N),P=(a(241),a(102),function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).state={email:"",name:"",error:!1,errorMessage:"",employeId:"",_loading:!1,forceDisable:!1,forceUpdate:!1},e.componentDidMount=function(){window.showLoginError=e.showLoginError},e.onInputChange=function(t){t.preventDefault();var a=t.target.value;"employeId"===t.target.name&&(a=a.substr(0,10)),e.setState(Object(g.a)({},t.target.name,a))},e.showLoginError=function(t){e.setState({error:!0,errorMessage:t.message?t.message:t})},e.validateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},e.onFormSubmit=function(){var t=Object(l.a)(c.a.mark((function t(a){var n,o,i,r,s;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a.preventDefault(),t.prev=1,e.setState({error:!1,forceDisable:!0}),n=e.state.employeId.toLowerCase().replace(/\s+/g,""),o="".concat(n,"@event.com"),i="".concat(n,"123456"),r=e.state.name,t.next=10,e.context.loadUser(o,i,r,!0,n);case 10:t.next=29;break;case 12:t.prev=12,t.t0=t.catch(1),e.setState({forceDisable:!1}),s="",t.t1=t.t0.code,t.next="auth/wrong-password"===t.t1?19:"auth/user-not-found"===t.t1?21:"auth/too-many-requests"===t.t1?23:"NoUserFound"===t.t1?25:27;break;case 19:return s="Invalid username and password.",t.abrupt("break",28);case 21:return s="User not registered",t.abrupt("break",28);case 23:return s="Too many invalid requests, please wait for 60 seconds before retrying",t.abrupt("break",28);case 25:return s="User not registered",t.abrupt("break",28);case 27:s=t.t0.message;case 28:e.setState({error:!0,errorMessage:s});case 29:case"end":return t.stop()}}),t,null,[[1,12]])})));return function(e){return t.apply(this,arguments)}}(),e}return Object(d.a)(a,[{key:"render",value:function(){return this.state._loading?o.a.createElement("img",{alt:"loading",src:"/images/loader.gif"}):o.a.createElement("section",{className:"landing-page min-height-full"},o.a.createElement("aside",{className:"landing-pageBox d-flex justify-content-between align-items-start min-height-full image-bg",style:{backgroundImage:"url(/assets/images/login.jpg)"}}),o.a.createElement("aside",{className:"signinBox min-height-full"},this.props.showLoggingIn&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"signinBox__heading"},o.a.createElement("div",{className:"middle"})),o.a.createElement("br",null),o.a.createElement("div",{className:"loaderContainer"},o.a.createElement("img",{src:"/assets/images/Loader.gif",alt:"loader"}),o.a.createElement("div",null,"Logging you in..."))),!this.props.showLoggingIn&&o.a.createElement(o.a.Fragment,null,o.a.createElement("form",{onSubmit:this.onFormSubmit},o.a.createElement("div",{className:"signinBox__heading"},o.a.createElement("div",{className:"middle"})),o.a.createElement("div",{className:"signinBox__body pd-t50"},o.a.createElement("div",{className:"signinBox_title"},"Participant Login"),o.a.createElement("div",{className:"form-group mg-b50"},o.a.createElement("input",{type:"text",className:"form-control form-control-login",name:"name",value:this.state.name,placeholder:"Enter Name",onChange:this.onInputChange,autoComplete:"off",autoCorrect:"off",required:!0})),o.a.createElement("div",{className:"form-group mg-b50"},o.a.createElement("input",{type:"number",className:"form-control form-control-login",name:"employeId",value:this.state.employeId,placeholder:"Enter Phone Number",onChange:this.onInputChange,autoComplete:"off",autoCorrect:"off",required:!0})),this.state.error&&o.a.createElement("div",{className:"mg-b50",style:{color:"red",fontSize:"1.25rem"}},this.state.errorMessage),o.a.createElement("div",{className:"text-center"},o.a.createElement("button",{className:"loginBtn",disabled:!!this.state.forceDisable||!this.state.employeId.length>0},"LOG IN")))))))}}]),a}(n.Component));P.contextType=v;var T=P,D=(Object(y.a)(),function(e){Object(h.a)(a,e);var t=Object(p.a)(a);function a(){var e;Object(u.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={user:null,rooms:null,room:null,showVideoCall:!0,isCurrentMeetingRoomOfficial:!1,showWhiteborad:!0},e.MeetingRoomMessage="",e.busyRoomMessage="",e.videoCall=o.a.createRef(),e.activeMeetingRoomDetails={},e.userId=null,e.getUserId=function(e){var t="";return e.phoneNumber?t="".concat(e.phoneNumber):null!==e.email&&(t=(t=e.email).toLowerCase()),t},e.removeLoader=function(){var e=document.querySelector(".platformStart");console.log(e),e&&e.remove()},e.joinFirstSlot=function(){e.state.rooms?e.onSlotJoin(e.state.rooms[0],e.state.rooms[0].slots[0]):setTimeout((function(){e.joinFirstSlot()}),1e3)},e.signIn=function(t,a){e.context.auth.signInWithEmailAndPassword(t,a).then((function(e){console.log(e)})).catch((function(e){console.log(e)}))},e.gettingMeetingRoomErrMessage=Object(l.a)(c.a.mark((function t(){var a;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.context.db.collection("backStage").doc("meetingRoomMessage").get();case 2:(a=t.sent).data&&(e.MeetingRoomMessage=a.data().meetingRoomMsg,e.busyRoomMessage=a.data().busyRoomMessage);case 4:case"end":return t.stop()}}),t)}))),e.updateMeetingRoom=function(){e.setState({rooms:e.context.meetingRooms})},e.closeMeetingRoom=function(){localStorage.getItem("lastLocation")?window.location.href=localStorage.getItem("lastLocation"):window.location.href="/login/index.html"},e.showMeetingRoomPopup=function(){},e.showMeetingRoomBusyPopup=function(){},e.checkForSlotAdmin=function(e,t){return!(!e||!t)&&-1!=e.indexOf(t)},e.onSlotJoin=function(t,a){window.parent.hideCrossBtn&&window.parent.hideCrossBtn(),e.activeMeetingRoomDetails={roomName:t.name,roomId:t.id,slotId:a.id,slot:a};var n=e.checkForSlotAdmin(a.adminID,e.userId);if(console.log(e.activeMeetingRoomDetails),e.setState({isCurrentMeetingRoomOfficial:n}),n){e.removeLoader();var o={roomId:a.id,roomName:a.name,roomParentId:t.id};e.setState({room:o}),e.setState({showVideoCall:!0})}else e.context.updateMeetingRoomDataAccLimit(t.name,t.id,a.id,!1,(function(n){if(n)console.log(n),e.showMeetingRoomBusyPopup();else{e.removeLoader();var o={roomId:a.id,roomName:a.name,roomParentId:t.id};e.setState({room:o}),e.setState({showVideoCall:!0})}}))},e.onCallDisconnect=function(t){if(window.parent.showCrossBtn&&window.parent.showCrossBtn(),e.checkForSlotAdmin(e.activeMeetingRoomDetails.slot.adminID,e.userId)||t)window.open("/index.html","_self");else{window.FirebaseObj.user_AnalyticsHandler("Meeting","enter"),console.log("exiting as a normal user");var a=e.activeMeetingRoomDetails;e.context.updateMeetingRoomDataAccLimit(a.roomName,a.roomId,a.slotId,!0,(function(e){e?console.log(e):window.open("/index.html","_self")}))}e.setState({showVideoCall:!1})},e.updateRoomStatus=function(){},e.currentSlotRest=function(){var t=Object(m.a)(e);setTimeout((function(){t.context.updateMeetingRoomDataAccLimit(t.activeMeetingRoomDetails.roomName,t.activeMeetingRoomDetails.roomId,t.activeMeetingRoomDetails.slotId,!0,(function(e){e&&console.log(e)}))}),2500)},e.addAnalytics=function(t){e.context.addHotspotAnalytics(t,e.context.currentUser)},e}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.listener=this.context.auth.onAuthStateChanged((function(t){t?(e.userId=e.getUserId(t),console.log(e.userId),console.log(t.email),e.context.currentUser=t,t.displayName||t.updateProfile({displayName:"".concat(t.email?t.email.split("@")[0]:t.phoneNumber?t.phoneNumber.slice(3):"GuestUser")}),e.setState({user:t}),e.context.updateMeetingRooms=e.updateMeetingRoom,e.context.attachMeetingRoomListener(),e.joinFirstSlot()):(console.log("user not logged in"),e.removeLoader())}))}},{key:"showInfoPopUp",value:function(e){O()({title:e,className:"video-swal-modal",button:"continue"})}},{key:"componentWillUnmount",value:function(){this.listener&&this.listener()}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,!this.state.user&&o.a.createElement(T,null),this.state.showVideoCall&&this.state.user&&this.state.user.displayName&&this.state.room&&o.a.createElement(o.a.Fragment,null,o.a.createElement(j,{userName:this.state.user.displayName,userId:this.userId,room:this.state.room,onCallDisconnect:this.onCallDisconnect,ref:this.videoCall,updateRoomStatus:this.updateRoomStatus,isOfficial:this.state.isCurrentMeetingRoomOfficial,liveRooms:this.state.rooms,slotReset:this.currentSlotRest,showPopup:this.showMeetingRoomPopup,showBusyPopup:this.showMeetingRoomBusyPopup,showInfoPopUp:this.showInfoPopUp})))}}]),a}(n.Component));D.contextType=v;var B=D;Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(v.Provider,{value:new k},o.a.createElement(o.a.StrictMode,null,o.a.createElement(B,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[109,1,2]]]);
//# sourceMappingURL=main.80791429.chunk.js.map